# 用户故事 (User Stories)

本文档从实际使用场景出发，描述不同角色个人用户的需求和期望。每个故事包含角色、目标、动机和验收标准。

---

## 角色定义

- **个人用户（Personal User）**：使用PonyBunny作为个人助理的独立个体
- **开发者（Developer）**：集成PonyBunny到个人工作流或编写自定义工具的技术用户
- **自雇者（Self-employed）**：Freelancer、独立咨询师、设计师等
- **小团队成员（Team Member）**：2-5人松耦合协作团队的成员

---

## Epic 1: 24x7个人自动化

### Story 1.1: 早晨自动唤醒与信息汇总

**作为** 个人用户  
**我想** 每天早上8点Agent自动播报今日重要信息  
**以便** 我起床时立即了解一天的安排和重要事件

**验收标准**：
- [ ] 配置Cron任务：`0 8 * * * agent run "早间播报"`
- [ ] Agent自动总结：日历事件、未读邮件、GitHub通知、天气预报
- [ ] 通过HomePod或手机语音播报（TTS集成）

**技术关联**：Cron Lane、多数据源集成

---

### Story 1.2: 跨平台无缝对话

**作为** 个人用户  
**我想** 在手机WhatsApp开始的对话能在电脑Telegram继续  
**以便** 我不受限于单一设备或平台

**验收标准**：
- [ ] 在WhatsApp发送"帮我分析这份日志"后，Agent在Telegram的回复能正确引用之前的上下文
- [ ] Session ID在不同Channel间保持一致
- [ ] 切换平台后，对话历史完整可见（包括6个月前的对话）

**技术关联**：多Channel集成、Session管理、长期记忆

---

### Story 1.3: 紧急任务中止

**作为** 个人用户  
**我想** 立即停止Agent正在执行的错误命令（如误删文件）  
**以便** 避免个人数据损坏或资源浪费

**验收标准**：
- [ ] 通过Telegram发送`/stop`后1秒内，Agent停止调用新的工具
- [ ] 已启动的Docker容器被立即终止
- [ ] UI显示"任务已中止"状态，并展示已完成的步骤

**技术关联**：AbortController、任务中止机制

---

## Epic 2: 个人知识管理

### Story 2.1: 长期学习伙伴

**作为** 个人开发者  
**我想** Agent能记住我3个月前学习Rust时的问题和进度  
**以便** 我不需要重复解释背景

**验收标准**：
- [ ] 在学习Rust的第90天，Agent仍能回忆起第10天提到的"所有权规则"
- [ ] 查询"我当初为什么选择async/await"能得到精准答案（基于Vector Memory）
- [ ] 手动触发`/compact`后，关键学习决策点保留在压缩历史中

**技术关联**：Session Compaction、Vector Memory、长期记忆

---

### Story 2.2: 个人日记分析

**作为** 自由作家  
**我想** Agent定期分析我的工作日记，发现创作模式  
**以便** 优化我的创作时间安排

**验收标准**：
- [ ] 每天通过语音输入工作日记，Agent自动转文本并索引
- [ ] 每周Agent生成报告："你通常在下午3点创意最活跃"
- [ ] 查询"去年夏天我在纠结什么问题"，精准定位相关日记

**技术关联**：语音转文本、Vector Memory、定期分析

---

### Story 2.3: 个人文献管理

**作为** 研究生  
**我想** Agent能索引我阅读的所有PDF论文，并支持跨文献检索  
**以便** 快速找到支持我论点的研究

**验收标准**：
- [ ] 上传PDF后，Agent自动提取关键信息并索引到Vector Memory
- [ ] 查询"哪些研究证明了X疗法的有效性"，返回Top 5相关论文
- [ ] 所有数据本地存储，不上传云端（隐私保护）

**技术关联**：PDF解析、Vector Search、本地存储

---

## Epic 3: 个人生产力倍增

### Story 3.1: 自动代码审查

**作为** 个人开发者  
**我想** 每次Git push后自动触发代码审查  
**以便** 在合并前发现问题

**验收标准**：
- [ ] GitHub Webhook配置：`push`事件 → PonyBunny
- [ ] Agent自动分析diff，检查代码规范、潜在bug
- [ ] 审查结果通过GitHub Comment发布（或Slack通知）

**技术关联**：Webhook集成、代码分析工具

---

### Story 3.2: 低成本运营

**作为** 个人用户  
**我想** 简单任务用便宜模型，复杂任务用强模型  
**以便** 月API成本控制在$10以内

**验收标准**：
- [ ] 配置`agents.defaults.subagent.model: "gpt-3.5-turbo"`
- [ ] 文件读取、日志解析等简单任务自动使用GPT-3.5
- [ ] 代码审查、复杂推理使用Claude Sonnet
- [ ] 月度成本报告显示节省 > 60%

**技术关联**：混合模型策略

---

### Story 3.3: 完全本地运行（零成本）

**作为** 隐私敏感用户  
**我想** 使用本地模型完全离线运行  
**以便** 处理个人财务、医疗数据

**验收标准**：
- [ ] 配置PonyBunny连接Ollama（Llama 3 8B）
- [ ] 所有对话和分析不调用外部API
- [ ] 响应速度可接受（< 5秒，在M2 MacBook Pro）

**技术关联**：Ollama集成、本地模型支持

---

## Epic 4: 个人设备协同

### Story 4.1: 远程拍照并处理

**作为** 个人用户  
**我想** Agent调用我办公室的iPad拍摄白板，并自动转为文本  
**以便** 远程参与会议讨论

**验收标准**：
- [ ] 用户发送"拍摄会议室白板"（通过Telegram）
- [ ] Agent识别需求，调用已配对iPad的`camera.snap`
- [ ] 照片上传后，自动OCR转为Markdown文本
- [ ] 结果发送回用户手机

**技术关联**：Node系统、跨设备工具调用、OCR集成

---

### Story 4.2: 智能家居定时控制

**作为** 技术爱好者  
**我想** 每天早上7点，Agent根据天气决定是否提醒带伞  
**以便** 出门前准备充分

**验收标准**：
- [ ] 配置Cron任务：`0 7 * * * agent run "早间天气提醒"`
- [ ] Agent查询天气API，判断降雨概率
- [ ] 如果 > 60%，通过HomePod播报"今天有雨，记得带伞"

**技术关联**：Cron Lane、天气API、智能音箱集成

---

### Story 4.3: 设备配对与安全

**作为** 个人用户  
**我想** 新iPhone连接前必须人工批准  
**以便** 防止未授权设备访问我的Agent

**验收标准**：
- [ ] 新设备连接时，手机收到配对请求通知
- [ ] 未批准前，该设备的`camera.snap`调用返回"未授权"错误
- [ ] 批准后，设备立即可用，无需重启

**技术关联**：设备配对、Pairing Token机制

---

## Epic 5: 个人成本优化

### Story 5.1: Embedding缓存节省成本

**作为** 个人用户  
**我想** 相同文件重复索引时不调用Embedding API  
**以便** 节省API成本

**验收标准**：
- [ ] 首次索引代码库后，缓存所有Embedding
- [ ] 第二次索引时，Embedding API调用次数 = 0
- [ ] 缓存命中率 > 90%（查看统计报告）

**技术关联**：Embedding Cache

---

### Story 5.2: 成本可视化

**作为** 个人用户  
**我想** 查看本月每天的API消耗和估算费用  
**以便** 控制预算

**验收标准**：
- [ ] 访问Web UI的"成本仪表盘"
- [ ] 显示：每日Token消耗、按模型分组的费用、月度预测
- [ ] 设置预算上限后，达到90%时发送Telegram警告

**技术关联**：Token统计、费用估算（未来功能）

---

## Epic 6: 个人安全与隐私

### Story 6.1: 完整审计日志

**作为** 个人用户  
**我想** 查看Agent过去7天的所有文件操作记录  
**以便** 验证没有误删重要数据

**验收标准**：
- [ ] 查询日志：`/audit file-operations --last 7d`
- [ ] 返回：所有`read`、`write`、`delete`操作，包括时间戳和文件路径
- [ ] 日志格式支持导出为CSV

**技术关联**：审计日志、工具调用记录

---

### Story 6.2: 数据导出与备份

**作为** 个人用户  
**我想** 一键导出所有对话历史和配置  
**以便** 迁移到新电脑或备份

**验收标准**：
- [ ] 执行命令：`docker exec ponybunny export-data`
- [ ] 生成ZIP包，包含：Session文件、SQLite数据库、配置文件
- [ ] 在新电脑导入后，对话历史和Vector Memory完整

**技术关联**：Session导出、数据迁移

---

### Story 6.3: 沙箱隔离测试

**作为** 个人开发者  
**我想** 让Agent执行实验性代码，但不担心破坏系统  
**以便** 安全测试新的Python库

**验收标准**：
- [ ] Agent执行`pip install risky-package && run-test()`
- [ ] 代码在Docker容器内运行，宿主机文件系统只读
- [ ] 即使代码有bug（如无限循环），容器资源限制防止系统卡死

**技术关联**：Docker沙箱、资源限制

---

## Epic 7: 个人用户体验

### Story 7.1: 流式输出即时反馈

**作为** 个人用户  
**我想** 看到Agent逐字输出回复（像真人打字）  
**以便** 不需要等待完整响应

**验收标准**：
- [ ] Agent开始回复后，首个Token在2秒内显示
- [ ] 后续Token的间隔 < 100ms
- [ ] 在Telegram中，长回复分段发送（避免消息过长）

**技术关联**：WebSocket流式传输、Delta事件

---

### Story 7.2: 思考过程可视化

**作为** 个人开发者  
**我想** 看到Agent分析代码时的推理过程  
**以便** 理解为什么它建议重构

**验收标准**：
- [ ] 开启Thinking Mode后，Web UI显示"Agent正在思考..."
- [ ] 思考内容折叠显示，点击展开查看详细推理步骤
- [ ] 最终答案与思考过程分开显示

**技术关联**：Thinking Level、UI设计

---

### Story 7.3: 移动端优化

**作为** 个人用户  
**我想** 在手机浏览器流畅管理Agent  
**以便** 外出时也能控制

**验收标准**：
- [ ] Web UI响应式设计，在iPhone/Android正确显示
- [ ] 虚拟键盘不遮挡输入框
- [ ] 支持语音输入（通过浏览器API）

**技术关联**：前端UI优化（未来功能）

---

## Epic 8: 社区与学习

### Story 8.1: 从模板快速启动

**作为** 新用户  
**我想** 从模板库安装"个人DevOps助手"配置  
**以便** 5分钟内开始使用

**验收标准**：
- [ ] 浏览模板市场，选择"DevOps助手"
- [ ] 一键安装后，Agent自动加载对应的System Prompt和工具（GitHub、Docker、Slack）
- [ ] 支持模板定制化（修改Prompt）

**技术关联**：配置模板系统（未来功能）

---

### Story 8.2: 分享自定义工具

**作为** 开发者  
**我想** 将编写的"PDF总结"工具分享给社区  
**以便** 其他用户受益

**验收标准**：
- [ ] 工具符合标准格式（`openclaw.plugin.json`）
- [ ] 提交到官方GitHub仓库
- [ ] 通过代码审查后，自动发布到NPM

**技术关联**：Plugin生态系统（未来功能）

---

## Epic 9: 特殊个人场景

### Story 9.1: 作家的创作助手

**作为** 自由作家  
**我想** Agent管理我的小说角色设定和剧情大纲  
**以便** 写作时快速查阅

**验收标准**：
- [ ] 上传角色设定文档后，Agent自动索引
- [ ] 查询"主角的童年经历是什么"，返回精准信息
- [ ] 所有数据本地存储，不上传云端（创意保护）

**技术关联**：Vector Memory、隐私保护

---

### Story 9.2: 自由职业者的客户管理

**作为** 自由设计师  
**我想** Agent记住每个客户的偏好和历史项目  
**以便** 提供个性化服务

**验收标准**：
- [ ] 客户A在3个月前讨论的配色方案，Agent能准确回忆
- [ ] 自动关联客户历史项目，提供个性化建议
- [ ] 查询"客户B上次要求的字体是什么"，精准回答

**技术关联**：长期记忆、客户数据管理

---

### Story 9.3: 健康数据追踪

**作为** 个人用户  
**我想** Agent帮我分析每日运动和饮食数据  
**以便** 优化健康习惯

**验收标准**：
- [ ] 通过Apple Health API自动导入运动数据
- [ ] 每周生成报告："本周平均步数8000步，建议增加到10000"
- [ ] 数据本地存储，不上传云端（健康隐私）

**技术关联**：API集成、数据分析（未来功能）

---

## 用户故事优先级

| Epic | P0（MVP） | P1（增强） | P2（高级） | P3（未来） |
|:-----|:---------|:----------|:----------|:----------|
| **24x7自动化** | 1.3（任务中止） | 1.1（早晨播报）、1.2（跨平台） | 4.2（智能家居） | - |
| **知识管理** | 2.1（长期记忆） | 2.2（日记分析） | 2.3（文献管理） | - |
| **生产力** | 3.2（成本优化） | 3.1（代码审查）、3.3（本地运行） | - | 5.2（成本可视化） |
| **设备协同** | 4.3（设备配对） | - | 4.1（远程拍照） | 4.2（智能家居） |
| **安全隐私** | 6.3（沙箱） | 6.1（审计日志）、6.2（数据导出） | - | - |
| **用户体验** | 7.1（流式输出） | 7.2（思考可视化） | 7.3（移动端） | - |
| **社区** | - | - | - | 8.1（模板）、8.2（工具分享） |
| **特殊场景** | - | 9.2（客户管理） | 9.1（作家助手） | 9.3（健康追踪） |

---

## 故事格式说明

每个用户故事遵循以下格式：

```
**作为** <角色>
**我想** <目标>
**以便** <动机>

**验收标准**：
- [ ] 可验证的具体标准1
- [ ] 可验证的具体标准2
- [ ] 可验证的具体标准3

**技术关联**：相关技术实现
```

---

## 总结

PonyBunny的用户故事聚焦于：
1. **个人自动化**：24x7工作、定时任务、跨平台统一
2. **隐私保护**：本地存储、离线运行、数据不外泄
3. **成本可控**：混合模型、缓存优化、月成本<$10
4. **易用性**：15分钟部署、模板快速启动、移动端支持

所有故事都围绕"个人用户的24x7数字员工"这一核心定位展开。
